<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Beachbody Portion Control Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-title h1 {
            font-size: 2.5em;
            margin-bottom: 5px;
        }

        .header-title p {
            opacity: 0.9;
        }

        .profile-selector {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .profile-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid white;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .profile-btn:hover, .profile-btn.active {
            background: white;
            color: #667eea;
        }

        .content {
            padding: 30px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid #e5e7eb;
        }

        .tab {
            padding: 15px 25px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 1.1em;
            color: #6b7280;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
            font-weight: 600;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .section-title {
            font-size: 1.8em;
            color: #667eea;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
        }

        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6b7280;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
        }

        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
        }

        .containers-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .container-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border: 3px solid;
        }

        .container-card.green { border-color: #10b981; background: #d1fae5; }
        .container-card.purple { border-color: #8b5cf6; background: #ede9fe; }
        .container-card.red { border-color: #ef4444; background: #fee2e2; }
        .container-card.yellow { border-color: #f59e0b; background: #fef3c7; }
        .container-card.blue { border-color: #3b82f6; background: #dbeafe; }
        .container-card.orange { border-color: #f97316; background: #ffedd5; }
        .container-card.tsp { border-color: #ec4899; background: #fce7f3; }

        .container-name {
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 1.1em;
        }

        .container-type {
            font-size: 0.85em;
            color: #666;
            margin-bottom: 10px;
        }

        .container-count {
            font-size: 2em;
            font-weight: bold;
            color: #333;
        }

        .tracker-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .tracker-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-left: 5px solid;
        }

        .tracker-card.green { border-left-color: #10b981; }
        .tracker-card.purple { border-left-color: #8b5cf6; }
        .tracker-card.red { border-left-color: #ef4444; }
        .tracker-card.yellow { border-left-color: #f59e0b; }
        .tracker-card.blue { border-left-color: #3b82f6; }
        .tracker-card.orange { border-left-color: #f97316; }
        .tracker-card.tsp { border-left-color: #ec4899; }

        .tracker-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .tracker-title {
            font-weight: bold;
            font-size: 1.1em;
        }

        .tracker-target {
            background: #f3f4f6;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.9em;
        }

        .counter-controls {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .counter-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            background: #667eea;
            color: white;
            font-size: 1.5em;
            cursor: pointer;
            transition: all 0.2s;
        }

        .counter-btn:hover {
            background: #764ba2;
            transform: scale(1.1);
        }

        .counter-value {
            font-size: 2em;
            font-weight: bold;
            min-width: 50px;
            text-align: center;
        }

        .progress-bar {
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            margin-top: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981 0%, #059669 100%);
            transition: width 0.3s;
        }

        .alert {
            background: #fef3c7;
            border-left: 4px solid #f59e0b;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .alert-title {
            font-weight: bold;
            margin-bottom: 5px;
            color: #92400e;
        }

        .metrics-timeline {
            margin-top: 30px;
        }

        .timeline-item {
            background: #f9fafb;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
        }

        .timeline-date {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }

        .timeline-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .metric-item {
            display: flex;
            flex-direction: column;
        }

        .metric-label {
            font-size: 0.85em;
            color: #6b7280;
        }

        .metric-value {
            font-size: 1.3em;
            font-weight: bold;
            color: #111827;
        }

        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-top: 20px;
        }

        .hidden {
            display: none;
        }

        .info-box {
            background: #eff6ff;
            border-left: 4px solid #3b82f6;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .macros-display {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .macro-card {
            background: #f9fafb;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
        }

        .macro-label {
            font-size: 0.9em;
            color: #6b7280;
            margin-bottom: 5px;
        }

        .macro-value {
            font-size: 2em;
            font-weight: bold;
            color: #111827;
        }

        .macro-percentage {
            font-size: 0.85em;
            color: #667eea;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-title">
                <h1>ü•ó Beachbody Portion Control</h1>
                <p>Track your daily nutrition and body metrics</p>
            </div>
            <div class="profile-selector">
                <button class="profile-btn active" onclick="switchProfile('user1')" id="profile1Btn">Profile 1</button>
                <button class="profile-btn" onclick="switchProfile('user2')" id="profile2Btn">Profile 2</button>
            </div>
        </div>

        <div class="content">
            <div class="tabs">
                <button class="tab active" onclick="switchTab('daily')">üìÖ Daily Tracker</button>
                <button class="tab" onclick="switchTab('profile')">üë§ Profile Setup</button>
                <button class="tab" onclick="switchTab('metrics')">üìä Body Metrics</button>
                <button class="tab" onclick="switchTab('foodguide')">ü•ò Food Guide</button>
                <button class="tab" onclick="switchTab('history')">üìà Progress History</button>
            </div>

            <!-- Profile Setup Tab -->
            <div class="tab-content" id="profileTab">
                <h2 class="section-title">Profile Setup</h2>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label>Name</label>
                        <input type="text" id="profileName" placeholder="Enter name">
                    </div>
                    <div class="form-group">
                        <label>Gender</label>
                        <select id="profileGender">
                            <option value="male">Male</option>
                            <option value="female">Female</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Age (years)</label>
                        <input type="number" id="profileAge" placeholder="Age" min="18" max="100">
                    </div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label>Height (cm)</label>
                        <input type="number" id="profileHeight" placeholder="Height in cm" min="120" max="250" step="0.5">
                    </div>
                    <div class="form-group">
                        <label>Current Weight (kg)</label>
                        <input type="number" id="profileWeight" placeholder="Current weight" min="40" max="250" step="0.1">
                    </div>
                    <div class="form-group">
                        <label>Goal Weight (kg)</label>
                        <input type="number" id="profileGoalWeight" placeholder="Goal weight" min="40" max="250" step="0.1">
                    </div>
                </div>

                <div class="form-group">
                    <label>Calculation Method</label>
                    <select id="calculationMethod">
                        <option value="mifflin">Mifflin-St Jeor (Most Accurate)</option>
                        <option value="beachbody">Beachbody Simple Formula</option>
                    </select>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label>Body Fat % (optional)</label>
                        <input type="number" id="profileBodyFat" placeholder="Body fat percentage" min="5" max="60" step="0.1">
                    </div>
                    <div class="form-group">
                        <label>Activity Level</label>
                        <select id="profileActivity">
                            <option value="1.2">Sedentary (little/no exercise)</option>
                            <option value="1.375">Light (1-3 days/week)</option>
                            <option value="1.55">Moderate (3-5 days/week)</option>
                            <option value="1.725">Active (6-7 days/week)</option>
                            <option value="1.9">Very Active (intense daily)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Goal</label>
                        <select id="profileGoal">
                            <option value="deficit">Weight Loss (500 cal deficit)</option>
                            <option value="maintain">Maintain Weight</option>
                            <option value="surplus">Muscle Gain (250 cal surplus)</option>
                        </select>
                    </div>
                </div>

                <button class="btn" onclick="saveProfile()">üíæ Save Profile & Calculate Plan</button>

                <div id="calculatedPlan" class="hidden">
                    <div class="info-box">
                        <h3 style="margin-bottom: 10px;">Your Nutrition Plan</h3>
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-label">Daily Calories</div>
                                <div class="stat-value" id="displayCalories">0</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">BMR</div>
                                <div class="stat-value" id="displayBMR">0</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">TDEE</div>
                                <div class="stat-value" id="displayTDEE">0</div>
                            </div>
                        </div>

                        <h4 style="margin: 20px 0 10px 0;">Macronutrient Breakdown</h4>
                        <div class="macros-display" id="macrosDisplay"></div>

                        <h4 style="margin: 20px 0 10px 0;">Your Container Allocation</h4>
                        <div class="containers-grid" id="planContainers"></div>
                    </div>
                </div>
            </div>

            <!-- Daily Tracker Tab -->
            <div class="tab-content active" id="dailyTab">
                <h2 class="section-title">Daily Container Tracker</h2>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Current Streak</div>
                        <div class="stat-value" id="streakDisplay">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Today's Progress</div>
                        <div class="stat-value" id="progressDisplay">0%</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Target Calories</div>
                        <div class="stat-value" id="calorieDisplay">-</div>
                    </div>
                </div>

                <div id="trackerContent">
                    <p style="text-align: center; padding: 40px; color: #6b7280;">
                        Please set up your profile first to start tracking.
                    </p>
                </div>

                <div id="missedAlert" class="alert hidden">
                    <div class="alert-title">‚ö†Ô∏è Containers Remaining Today</div>
                    <ul id="missedList" style="margin-top: 10px; padding-left: 20px;"></ul>
                </div>

                <button class="btn hidden" id="completeDayBtn" onclick="completeDay()" style="margin-top: 20px;">
                    ‚úÖ Complete Day
                </button>
            </div>

            <!-- Body Metrics Tab -->
            <div class="tab-content" id="metricsTab">
                <h2 class="section-title">Body Metrics Tracking</h2>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label>Date</label>
                        <input type="date" id="metricDate">
                    </div>
                    <div class="form-group">
                        <label>Weight (kg)</label>
                        <input type="number" id="metricWeight" placeholder="Weight" step="0.1">
                    </div>
                    <div class="form-group">
                        <label>Body Fat % (optional)</label>
                        <input type="number" id="metricBodyFat" placeholder="Body fat %" step="0.1">
                    </div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label>Waist (inches)</label>
                        <input type="number" id="metricWaist" placeholder="Waist measurement" step="0.1">
                    </div>
                    <div class="form-group">
                        <label>Hips (inches)</label>
                        <input type="number" id="metricHips" placeholder="Hip measurement" step="0.1">
                    </div>
                    <div class="form-group">
                        <label>Chest (inches)</label>
                        <input type="number" id="metricChest" placeholder="Chest measurement" step="0.1">
                    </div>
                </div>

                <h3 style="margin: 30px 0 15px 0; color: #667eea;">Workout Tracking</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Beachbody Workout</label>
                        <select id="workoutType">
                            <option value="">None</option>
                            <option value="Body Beast">Body Beast</option>
                            <option value="P90X">P90X</option>
                            <option value="P90X3">P90X3</option>
                            <option value="Insanity">Insanity</option>
                            <option value="21 Day Fix">21 Day Fix</option>
                            <option value="LIIFT4">LIIFT4</option>
                            <option value="Morning Meltdown 100">Morning Meltdown 100</option>
                            <option value="10 Rounds">10 Rounds</option>
                            <option value="6 Weeks of The Work">6 Weeks of The Work</option>
                            <option value="MBF">MBF (Muscle Burns Fat)</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Workout Duration (minutes)</label>
                        <input type="number" id="workoutDuration" placeholder="Minutes" min="0">
                    </div>
                    <div class="form-group">
                        <label>Steps/Walking (steps)</label>
                        <input type="number" id="dailySteps" placeholder="e.g., 10000" min="0">
                    </div>
                </div>

                <div class="form-group">
                    <label>Progress Photo (optional)</label>
                    <input type="file" id="metricPhoto" accept="image/*" capture="environment">
                    <small style="color: #6b7280; margin-top: 5px; display: block;">Take a weekly progress photo</small>
                </div>

                <div class="form-group">
                    <label>Notes</label>
                    <input type="text" id="metricNotes" placeholder="How are you feeling? Any observations?">
                </div>

                <button class="btn" onclick="saveMetrics()">üíæ Save Metrics</button>

                <div class="metrics-timeline" id="metricsTimeline"></div>
            </div>

            <!-- History Tab -->
            <div class="tab-content" id="historyTab">
                <h2 class="section-title">Progress History</h2>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Total Days Tracked</div>
                        <div class="stat-value" id="totalDays">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Best Streak</div>
                        <div class="stat-value" id="bestStreak">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Compliance Rate</div>
                        <div class="stat-value" id="complianceRate">0%</div>
                    </div>
                </div>

                <div class="chart-container">
                    <h3 style="margin-bottom: 15px;">Weight Progress</h3>
                    <div id="weightChart"></div>
                </div>

                <div class="chart-container">
                    <h3 style="margin-bottom: 15px;">Container Completion by Week</h3>
                    <div id="containerChart"></div>
                </div>
            </div>

            <!-- Food Guide Tab -->
            <div class="tab-content" id="foodguideTab">
                <h2 class="section-title">ü•ò Indian Food Guide</h2>
                
                <div class="info-box">
                    <p style="margin-bottom: 10px;">Quick reference for common Indian foods and their container equivalents. Use this guide when logging your daily containers.</p>
                </div>

                <div style="margin-top: 30px;">
                    <div class="container-card green" style="margin-bottom: 20px;">
                        <h3 style="margin-bottom: 15px;">üü¢ GREEN - Vegetables</h3>
                        <div style="text-align: left; padding: 0 10px;">
                            <p><strong>1 Green Container =</strong></p>
                            <ul style="margin-top: 10px; line-height: 1.8;">
                                <li>1 cup cooked palak (spinach)</li>
                                <li>1 cup bhindi (okra)</li>
                                <li>1 cup baingan (eggplant)</li>
                                <li>1 cup karela (bitter gourd)</li>
                                <li>1 cup lauki (bottle gourd)</li>
                                <li>1 cup capsicum (bell peppers)</li>
                                <li>1 cup gobi (cauliflower)</li>
                                <li>1 cup beans (French beans)</li>
                                <li>1 cup mixed vegetables (sabzi)</li>
                                <li>1 medium tomato</li>
                                <li>2 cups salad (cucumber, tomato, onion)</li>
                            </ul>
                        </div>
                    </div>

                    <div class="container-card purple" style="margin-bottom: 20px;">
                        <h3 style="margin-bottom: 15px;">üü£ PURPLE - Fruits</h3>
                        <div style="text-align: left; padding: 0 10px;">
                            <p><strong>1 Purple Container =</strong></p>
                            <ul style="margin-top: 10px; line-height: 1.8;">
                                <li>1 medium apple (seb)</li>
                                <li>1 medium banana (kela) - small size</li>
                                <li>1 cup papaya (papita)</li>
                                <li>1 cup watermelon (tarbooz)</li>
                                <li>1 medium orange (santra)</li>
                                <li>¬Ω cup mango (aam) pieces</li>
                                <li>1 cup guava (amrud)</li>
                                <li>15-20 grapes (angoor)</li>
                                <li>1 cup pomegranate (anar) seeds</li>
                                <li>2-3 small chikoo</li>
                            </ul>
                        </div>
                    </div>

                    <div class="container-card red" style="margin-bottom: 20px;">
                        <h3 style="margin-bottom: 15px;">üî¥ RED - Proteins</h3>
                        <div style="text-align: left; padding: 0 10px;">
                            <p><strong>1 Red Container =</strong></p>
                            <ul style="margin-top: 10px; line-height: 1.8;">
                                <li><strong>100g paneer</strong> (cottage cheese) - about 4-5 cubes</li>
                                <li>150g chicken breast (cooked)</li>
                                <li>150g fish (cooked)</li>
                                <li>2 whole eggs</li>
                                <li>4 egg whites</li>
                                <li>1 cup Greek yogurt (plain)</li>
                                <li>¬æ cup cooked dal (lentils - counted as BOTH red protein + yellow carb)</li>
                                <li>¬Ω cup rajma (kidney beans)</li>
                                <li>¬Ω cup chole (chickpeas)</li>
                                <li>¬º cup tofu</li>
                                <li>Protein powder (1 scoop ~30g)</li>
                            </ul>
                            <p style="margin-top: 10px; font-style: italic; color: #666;"><strong>Note:</strong> Paneer is primarily RED. Dal/legumes count as both RED (protein) and YELLOW (carb) - count as 1 red + 1 yellow when eating.</p>
                        </div>
                    </div>

                    <div class="container-card yellow" style="margin-bottom: 20px;">
                        <h3 style="margin-bottom: 15px;">üü° YELLOW - Carbs</h3>
                        <div style="text-align: left; padding: 0 10px;">
                            <p><strong>1 Yellow Container =</strong></p>
                            <ul style="margin-top: 10px; line-height: 1.8;">
                                <li><strong>1 medium roti</strong> (chapati - whole wheat)</li>
                                <li><strong>2 small rotis</strong> = 1 yellow</li>
                                <li>¬Ω cup cooked rice (chawal)</li>
                                <li>¬Ω cup cooked quinoa</li>
                                <li>1 medium sweet potato (shakarkandi)</li>
                                <li>1 medium potato (aloo)</li>
                                <li>¬Ω cup oats (cooked)</li>
                                <li>¬Ω cup poha</li>
                                <li>¬Ω cup upma</li>
                                <li>1 slice whole wheat bread</li>
                                <li>¬æ cup cooked dal (count as red + yellow)</li>
                                <li>¬Ω cup rajma/chole (count as red + yellow)</li>
                            </ul>
                            <p style="margin-top: 10px; font-style: italic; color: #666;"><strong>Note:</strong> Most Indian meals with dal/legumes = 1 red + 1 yellow per serving</p>
                        </div>
                    </div>

                    <div class="container-card blue" style="margin-bottom: 20px;">
                        <h3 style="margin-bottom: 15px;">üîµ BLUE - Healthy Fats</h3>
                        <div style="text-align: left; padding: 0 10px;">
                            <p><strong>1 Blue Container =</strong></p>
                            <ul style="margin-top: 10px; line-height: 1.8;">
                                <li>¬º avocado</li>
                                <li>12 almonds (badam)</li>
                                <li>14 cashews (kaju)</li>
                                <li>8 walnuts (akhrot) halves</li>
                                <li>2 tablespoons hummus</li>
                                <li>¬º cup shredded coconut (nariyal)</li>
                                <li>2 tablespoons cheese (NOT paneer - paneer is RED)</li>
                            </ul>
                            <p style="margin-top: 10px; font-style: italic; color: #666;"><strong>Important:</strong> Paneer is NOT blue - it's a RED protein!</p>
                        </div>
                    </div>

                    <div class="container-card orange" style="margin-bottom: 20px;">
                        <h3 style="margin-bottom: 15px;">üü† ORANGE - Seeds & Dressings</h3>
                        <div style="text-align: left; padding: 0 10px;">
                            <p><strong>1 Orange Container =</strong></p>
                            <ul style="margin-top: 10px; line-height: 1.8;">
                                <li>2 tablespoons pumpkin seeds</li>
                                <li>2 tablespoons sunflower seeds</li>
                                <li>2 tablespoons flax seeds</li>
                                <li>2 tablespoons chia seeds</li>
                                <li>4 tablespoons salad dressing (vinaigrette)</li>
                            </ul>
                        </div>
                    </div>

                    <div class="container-card tsp" style="margin-bottom: 20px;">
                        <h3 style="margin-bottom: 15px;">üü§ TSP - Oils & Nut Butters</h3>
                        <div style="text-align: left; padding: 0 10px;">
                            <p><strong>1 tsp Container =</strong></p>
                            <ul style="margin-top: 10px; line-height: 1.8;">
                                <li>1 teaspoon ghee (clarified butter)</li>
                                <li>1 teaspoon cooking oil (any type)</li>
                                <li>1 teaspoon butter (makkhan)</li>
                                <li>1 teaspoon almond butter</li>
                                <li>1 teaspoon peanut butter</li>
                                <li>1 teaspoon coconut oil</li>
                                <li>1 teaspoon olive oil</li>
                            </ul>
                            <p style="margin-top: 10px; font-style: italic; color: #666;"><strong>Track carefully:</strong> Indian cooking often uses multiple tsp of ghee/oil per meal!</p>
                        </div>
                    </div>

                    <div style="background: #fef3c7; padding: 20px; border-radius: 12px; border-left: 4px solid #f59e0b;">
                        <h3 style="color: #92400e; margin-bottom: 10px;">üí° Common Indian Meal Examples</h3>
                        <ul style="line-height: 1.8; color: #78350f;">
                            <li><strong>Dal Chawal:</strong> 1 red + 1 yellow (dal) + 1 yellow (rice) + 1 tsp (ghee)</li>
                            <li><strong>Paneer Tikka:</strong> 1 red (paneer) + 1 green (peppers/onions) + 1 tsp (oil)</li>
                            <li><strong>Rajma Chawal:</strong> 1 red + 1 yellow (rajma) + 1 yellow (rice) + 1 tsp (oil)</li>
                            <li><strong>Roti with Sabzi:</strong> 2 yellow (2 rotis) + 1-2 green (vegetables) + 1-2 tsp (ghee/oil)</li>
                            <li><strong>Chicken Curry:</strong> 1 red (chicken) + 1 green (gravy/tomatoes) + 2-3 tsp (oil in curry)</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Container definitions
        const containers = {
            green: { name: 'Green', type: 'Vegetables', color: 'green' },
            purple: { name: 'Purple', type: 'Fruits', color: 'purple' },
            red: { name: 'Red', type: 'Proteins', color: 'red' },
            yellow: { name: 'Yellow', type: 'Carbs', color: 'yellow' },
            blue: { name: 'Blue', type: 'Healthy Fats', color: 'blue' },
            orange: { name: 'Orange', type: 'Seeds/Dressings', color: 'orange' },
            tsp: { name: 'tsp', type: 'Oils/Nut Butters', color: 'tsp' }
        };

        // Beachbody portion fix plans
        const containerPlans = {
            1200: { green: 3, purple: 2, red: 4, yellow: 2, blue: 1, orange: 1, tsp: 2 },
            1500: { green: 4, purple: 3, red: 4, yellow: 3, blue: 1, orange: 1, tsp: 2 },
            1800: { green: 5, purple: 3, red: 5, yellow: 4, blue: 1, orange: 1, tsp: 3 },
            2100: { green: 6, purple: 4, red: 6, yellow: 4, blue: 1, orange: 1, tsp: 4 },
            2400: { green: 8, purple: 4, red: 6, yellow: 5, blue: 2, orange: 1, tsp: 4 }
        };

        let currentProfile = 'user1';
        let profiles = {};
        let dailyLogs = {};
        let metrics = {};

        // Initialize on load
        async function init() {
            const today = new Date();
            document.getElementById('metricDate').valueAsDate = today;
            
            await loadData();
            updateUI();
        }

        async function loadData() {
            try {
                // Load profiles
                const profilesData = await window.storage.get('bb_profiles', true);
                if (profilesData) {
                    profiles = JSON.parse(profilesData.value);
                }

                // Load daily logs for current profile
                const logsData = await window.storage.get(`bb_logs_${currentProfile}`, false);
                if (logsData) {
                    dailyLogs = JSON.parse(logsData.value);
                }

                // Load metrics for current profile
                const metricsData = await window.storage.get(`bb_metrics_${currentProfile}`, false);
                if (metricsData) {
                    metrics = JSON.parse(metricsData.value);
                }
            } catch (error) {
                console.log('Initializing new data storage');
                profiles = { user1: null, user2: null };
                dailyLogs = {};
                metrics = {};
            }
        }

        async function saveData() {
            try {
                await window.storage.set('bb_profiles', JSON.stringify(profiles), true);
                await window.storage.set(`bb_logs_${currentProfile}`, JSON.stringify(dailyLogs), false);
                await window.storage.set(`bb_metrics_${currentProfile}`, JSON.stringify(metrics), false);
            } catch (error) {
                console.error('Error saving data:', error);
                alert('Error saving data. Please try again.');
            }
        }

        function switchProfile(profileId) {
            currentProfile = profileId;
            
            // Update button states
            document.getElementById('profile1Btn').classList.toggle('active', profileId === 'user1');
            document.getElementById('profile2Btn').classList.toggle('active', profileId === 'user2');
            
            loadData().then(() => updateUI());
        }

        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            // Refresh content based on tab
            if (tabName === 'daily') {
                renderDailyTracker();
            } else if (tabName === 'profile') {
                loadProfileForm();
            } else if (tabName === 'metrics') {
                renderMetricsTimeline();
            } else if (tabName === 'foodguide') {
                // Food guide is static, no rendering needed
            } else if (tabName === 'history') {
                renderHistory();
            }
        }

        function calculateBMR(weight, height, age, gender) {
            // Mifflin-St Jeor Equation (weight in kg, height in cm)
            if (gender === 'male') {
                return (10 * weight) + (6.25 * height) - (5 * age) + 5;
            } else {
                return (10 * weight) + (6.25 * height) - (5 * age) - 161;
            }
        }

        function calculateBeachbodyFormula(weightKg) {
            // Beachbody Simple Formula works with weight in pounds
            // Convert kg to lbs first
            const weightLbs = weightKg * 2.20462;
            
            // Weight(lbs) x 11 = Baseline
            // Baseline + 600 = Maintenance
            // Maintenance - 750 = Target
            const baseline = weightLbs * 11;
            const maintenance = baseline + 600;
            const target = maintenance - 750;
            
            return {
                baseline: Math.round(baseline),
                maintenance: Math.round(maintenance),
                target: Math.round(target),
                bmr: Math.round(baseline), // Use baseline as BMR equivalent
                weightLbs: Math.round(weightLbs)
            };
        }

        function calculateMacros(calories) {
            // Standard Beachbody macro split: 40% carbs, 30% protein, 30% fat
            const protein = Math.round(calories * 0.30 / 4);
            const carbs = Math.round(calories * 0.40 / 4);
            const fat = Math.round(calories * 0.30 / 9);
            
            return { protein, carbs, fat };
        }

        async function saveProfile() {
            const profile = {
                name: document.getElementById('profileName').value,
                gender: document.getElementById('profileGender').value,
                age: parseInt(document.getElementById('profileAge').value),
                height: parseFloat(document.getElementById('profileHeight').value),
                weight: parseFloat(document.getElementById('profileWeight').value),
                goalWeight: parseFloat(document.getElementById('profileGoalWeight').value),
                bodyFat: parseFloat(document.getElementById('profileBodyFat').value) || null,
                activity: parseFloat(document.getElementById('profileActivity').value),
                goal: document.getElementById('profileGoal').value,
                calculationMethod: document.getElementById('calculationMethod').value
            };

            // Validate
            if (!profile.name || !profile.age || !profile.height || !profile.weight) {
                alert('Please fill in all required fields');
                return;
            }

            let bmr, tdee, targetCalories;

            if (profile.calculationMethod === 'beachbody') {
                // Use Beachbody Simple Formula
                const bbCalc = calculateBeachbodyFormula(profile.weight);
                bmr = bbCalc.baseline;
                tdee = bbCalc.maintenance;
                targetCalories = bbCalc.target;
                
                profile.bmr = bmr;
                profile.tdee = tdee;
                profile.baseline = bbCalc.baseline;
                profile.weightLbs = bbCalc.weightLbs;
            } else {
                // Use Mifflin-St Jeor
                bmr = calculateBMR(profile.weight, profile.height, profile.age, profile.gender);
                tdee = Math.round(bmr * profile.activity);
                
                // Adjust for goal
                targetCalories = tdee;
                if (profile.goal === 'deficit') {
                    targetCalories = tdee - 500;
                } else if (profile.goal === 'surplus') {
                    targetCalories = tdee + 250;
                }

                profile.bmr = Math.round(bmr);
                profile.tdee = tdee;
            }

            // Find closest container plan
            const planCalories = [1200, 1500, 1800, 2100, 2400];
            const closestPlan = planCalories.reduce((prev, curr) => 
                Math.abs(curr - targetCalories) < Math.abs(prev - targetCalories) ? curr : prev
            );

            profile.targetCalories = Math.round(targetCalories);
            profile.planCalories = closestPlan;
            profile.containers = containerPlans[closestPlan];
            profile.macros = calculateMacros(targetCalories);

            profiles[currentProfile] = profile;
            await saveData();
            
            displayCalculatedPlan(profile);
            updateUI();
        }

        function displayCalculatedPlan(profile) {
            document.getElementById('calculatedPlan').classList.remove('hidden');
            document.getElementById('displayCalories').textContent = profile.targetCalories;
            document.getElementById('displayBMR').textContent = profile.bmr;
            document.getElementById('displayTDEE').textContent = profile.tdee;

            // If using Beachbody formula, show the breakdown
            if (profile.calculationMethod === 'beachbody' && profile.baseline) {
                document.getElementById('displayBMR').textContent = profile.baseline;
                document.getElementById('displayTDEE').textContent = profile.tdee;
                
                // Add explanation with the formula
                const infoBox = document.querySelector('.info-box h3');
                infoBox.innerHTML = `Your Nutrition Plan (Beachbody Formula)<br>
                    <small style="font-weight: normal; font-size: 0.7em; line-height: 1.6;">
                    Weight: ${profile.weight} kg = ${profile.weightLbs} lbs<br>
                    Baseline (${profile.weightLbs} lbs √ó 11) = ${profile.baseline} cal<br>
                    Maintenance (${profile.baseline} + 600) = ${profile.tdee} cal<br>
                    Target (${profile.tdee} - 750) = ${profile.targetCalories} cal
                    </small>`;
            } else {
                // Reset title for Mifflin-St Jeor
                const infoBox = document.querySelector('.info-box h3');
                infoBox.innerHTML = `Your Nutrition Plan`;
            }

            // Display macros
            const macrosHTML = `
                <div class="macro-card">
                    <div class="macro-label">Protein</div>
                    <div class="macro-value">${profile.macros.protein}g</div>
                    <div class="macro-percentage">30%</div>
                </div>
                <div class="macro-card">
                    <div class="macro-label">Carbs</div>
                    <div class="macro-value">${profile.macros.carbs}g</div>
                    <div class="macro-percentage">40%</div>
                </div>
                <div class="macro-card">
                    <div class="macro-label">Fat</div>
                    <div class="macro-value">${profile.macros.fat}g</div>
                    <div class="macro-percentage">30%</div>
                </div>
            `;
            document.getElementById('macrosDisplay').innerHTML = macrosHTML;

            // Display containers
            let containersHTML = '';
            for (const [key, info] of Object.entries(containers)) {
                const count = profile.containers[key];
                containersHTML += `
                    <div class="container-card ${info.color}">
                        <div class="container-name">${info.name}</div>
                        <div class="container-type">${info.type}</div>
                        <div class="container-count">${count}</div>
                    </div>
                `;
            }
            document.getElementById('planContainers').innerHTML = containersHTML;
        }

        function loadProfileForm() {
            const profile = profiles[currentProfile];
            if (profile) {
                document.getElementById('profileName').value = profile.name || '';
                document.getElementById('profileGender').value = profile.gender || 'male';
                document.getElementById('profileAge').value = profile.age || '';
                document.getElementById('profileHeight').value = profile.height || '';
                document.getElementById('profileWeight').value = profile.weight || '';
                document.getElementById('profileGoalWeight').value = profile.goalWeight || '';
                document.getElementById('profileBodyFat').value = profile.bodyFat || '';
                document.getElementById('profileActivity').value = profile.activity || '1.2';
                document.getElementById('profileGoal').value = profile.goal || 'deficit';
                document.getElementById('calculationMethod').value = profile.calculationMethod || 'mifflin';
                
                if (profile.targetCalories) {
                    displayCalculatedPlan(profile);
                }
            }
        }

        function renderDailyTracker() {
            const profile = profiles[currentProfile];
            if (!profile || !profile.containers) {
                document.getElementById('trackerContent').innerHTML = `
                    <p style="text-align: center; padding: 40px; color: #6b7280;">
                        Please set up your profile first to start tracking.
                    </p>
                `;
                document.getElementById('completeDayBtn').classList.add('hidden');
                return;
            }

            const today = new Date().toISOString().split('T')[0];
            if (!dailyLogs[today]) {
                dailyLogs[today] = {};
                Object.keys(containers).forEach(key => {
                    dailyLogs[today][key] = 0;
                });
            }

            let html = '<div class="tracker-grid">';
            for (const [key, info] of Object.entries(containers)) {
                const target = profile.containers[key];
                const current = dailyLogs[today][key] || 0;
                const progress = Math.min((current / target) * 100, 100);

                html += `
                    <div class="tracker-card ${info.color}">
                        <div class="tracker-header">
                            <div class="tracker-title">${info.name}</div>
                            <div class="tracker-target">Goal: ${target}</div>
                        </div>
                        <div class="counter-controls">
                            <button class="counter-btn" onclick="updateContainer('${key}', -1)">‚àí</button>
                            <div class="counter-value">${current}</div>
                            <button class="counter-btn" onclick="updateContainer('${key}', 1)">+</button>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${progress}%"></div>
                        </div>
                    </div>
                `;
            }
            html += '</div>';

            document.getElementById('trackerContent').innerHTML = html;
            document.getElementById('completeDayBtn').classList.remove('hidden');
            document.getElementById('calorieDisplay').textContent = profile.targetCalories;
            
            checkMissedContainers();
            updateStats();
        }

        async function updateContainer(key, delta) {
            const today = new Date().toISOString().split('T')[0];
            if (!dailyLogs[today]) {
                dailyLogs[today] = {};
            }
            
            dailyLogs[today][key] = Math.max(0, (dailyLogs[today][key] || 0) + delta);
            
            await saveData();
            renderDailyTracker();
        }

        function checkMissedContainers() {
            const profile = profiles[currentProfile];
            if (!profile) return;

            const today = new Date().toISOString().split('T')[0];
            const todayLog = dailyLogs[today] || {};
            
            const missed = [];
            for (const [key, info] of Object.entries(containers)) {
                const target = profile.containers[key];
                const current = todayLog[key] || 0;
                if (current < target) {
                    missed.push(`${info.name} (${info.type}): ${target - current} more needed`);
                }
            }

            const alert = document.getElementById('missedAlert');
            const list = document.getElementById('missedList');
            
            if (missed.length > 0) {
                list.innerHTML = missed.map(m => `<li>${m}</li>`).join('');
                alert.classList.remove('hidden');
            } else {
                alert.classList.add('hidden');
            }
        }

        function updateStats() {
            const profile = profiles[currentProfile];
            if (!profile) return;

            const today = new Date().toISOString().split('T')[0];
            const todayLog = dailyLogs[today] || {};
            
            let totalTarget = 0;
            let totalCurrent = 0;
            
            for (const [key, count] of Object.entries(profile.containers)) {
                totalTarget += count;
                totalCurrent += todayLog[key] || 0;
            }

            const progress = Math.round((totalCurrent / totalTarget) * 100);
            document.getElementById('progressDisplay').textContent = `${progress}%`;

            // Calculate streak
            const sortedDates = Object.keys(dailyLogs).sort().reverse();
            let streak = 0;
            let yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            
            for (const date of sortedDates) {
                const checkDate = new Date(date);
                if (checkDate.toISOString().split('T')[0] === yesterday.toISOString().split('T')[0] || 
                    checkDate.toISOString().split('T')[0] === today) {
                    
                    const dayLog = dailyLogs[date];
                    let complete = true;
                    for (const [key, target] of Object.entries(profile.containers)) {
                        if ((dayLog[key] || 0) < target) {
                            complete = false;
                            break;
                        }
                    }
                    
                    if (complete) {
                        streak++;
                        yesterday.setDate(yesterday.getDate() - 1);
                    } else {
                        break;
                    }
                } else {
                    break;
                }
            }

            document.getElementById('streakDisplay').textContent = streak;
        }

        async function completeDay() {
            const profile = profiles[currentProfile];
            if (!profile) return;

            const today = new Date().toISOString().split('T')[0];
            const todayLog = dailyLogs[today] || {};
            
            let allMet = true;
            for (const [key, target] of Object.entries(profile.containers)) {
                if ((todayLog[key] || 0) < target) {
                    allMet = false;
                    break;
                }
            }

            if (!allMet) {
                if (!confirm('You haven\'t met all container targets. Mark day as complete anyway?')) {
                    return;
                }
            }

            dailyLogs[today].completed = true;
            await saveData();
            
            alert(`Day completed! üéâ ${allMet ? 'Perfect adherence!' : 'Keep going tomorrow!'}`);
            updateStats();
        }

        async function saveMetrics() {
            const date = document.getElementById('metricDate').value;
            const weight = parseFloat(document.getElementById('metricWeight').value);
            
            if (!date || !weight) {
                alert('Please enter at least date and weight');
                return;
            }

            if (!metrics[date]) {
                metrics[date] = {};
            }

            // Handle photo upload
            const photoInput = document.getElementById('metricPhoto');
            let photoData = null;
            if (photoInput.files && photoInput.files[0]) {
                const file = photoInput.files[0];
                photoData = await new Promise((resolve) => {
                    const reader = new FileReader();
                    reader.onload = (e) => resolve(e.target.result);
                    reader.readAsDataURL(file);
                });
            }

            metrics[date] = {
                weight: weight,
                bodyFat: parseFloat(document.getElementById('metricBodyFat').value) || null,
                waist: parseFloat(document.getElementById('metricWaist').value) || null,
                hips: parseFloat(document.getElementById('metricHips').value) || null,
                chest: parseFloat(document.getElementById('metricChest').value) || null,
                workoutType: document.getElementById('workoutType').value || null,
                workoutDuration: parseInt(document.getElementById('workoutDuration').value) || null,
                dailySteps: parseInt(document.getElementById('dailySteps').value) || null,
                notes: document.getElementById('metricNotes').value || '',
                photo: photoData
            };

            await saveData();
            
            // Clear form
            document.getElementById('metricWeight').value = '';
            document.getElementById('metricBodyFat').value = '';
            document.getElementById('metricWaist').value = '';
            document.getElementById('metricHips').value = '';
            document.getElementById('metricChest').value = '';
            document.getElementById('workoutType').value = '';
            document.getElementById('workoutDuration').value = '';
            document.getElementById('dailySteps').value = '';
            document.getElementById('metricNotes').value = '';
            document.getElementById('metricPhoto').value = '';
            
            alert('Metrics saved successfully!');
            renderMetricsTimeline();
        }

        function renderMetricsTimeline() {
            const timeline = document.getElementById('metricsTimeline');
            const sortedDates = Object.keys(metrics).sort().reverse();
            
            if (sortedDates.length === 0) {
                timeline.innerHTML = '<p style="text-align: center; padding: 40px; color: #6b7280;">No metrics recorded yet.</p>';
                return;
            }

            let html = '';
            for (const date of sortedDates) {
                const metric = metrics[date];
                html += `
                    <div class="timeline-item">
                        <div class="timeline-date">${new Date(date).toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}</div>
                        
                        ${metric.photo ? `
                            <div style="margin: 15px 0;">
                                <img src="${metric.photo}" style="max-width: 300px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);" alt="Progress photo">
                            </div>
                        ` : ''}
                        
                        <div class="timeline-metrics">
                            <div class="metric-item">
                                <span class="metric-label">Weight</span>
                                <span class="metric-value">${metric.weight} kg</span>
                            </div>
                            ${metric.bodyFat ? `
                                <div class="metric-item">
                                    <span class="metric-label">Body Fat</span>
                                    <span class="metric-value">${metric.bodyFat}%</span>
                                </div>
                            ` : ''}
                            ${metric.waist ? `
                                <div class="metric-item">
                                    <span class="metric-label">Waist</span>
                                    <span class="metric-value">${metric.waist}"</span>
                                </div>
                            ` : ''}
                            ${metric.hips ? `
                                <div class="metric-item">
                                    <span class="metric-label">Hips</span>
                                    <span class="metric-value">${metric.hips}"</span>
                                </div>
                            ` : ''}
                            ${metric.chest ? `
                                <div class="metric-item">
                                    <span class="metric-label">Chest</span>
                                    <span class="metric-value">${metric.chest}"</span>
                                </div>
                            ` : ''}
                            ${metric.workoutType ? `
                                <div class="metric-item">
                                    <span class="metric-label">Workout</span>
                                    <span class="metric-value">${metric.workoutType}</span>
                                </div>
                            ` : ''}
                            ${metric.workoutDuration ? `
                                <div class="metric-item">
                                    <span class="metric-label">Duration</span>
                                    <span class="metric-value">${metric.workoutDuration} min</span>
                                </div>
                            ` : ''}
                            ${metric.dailySteps ? `
                                <div class="metric-item">
                                    <span class="metric-label">Steps</span>
                                    <span class="metric-value">${metric.dailySteps.toLocaleString()}</span>
                                </div>
                            ` : ''}
                        </div>
                        ${metric.notes ? `<p style="margin-top: 10px; color: #6b7280; font-style: italic;">${metric.notes}</p>` : ''}
                    </div>
                `;
            }
            
            timeline.innerHTML = html;
        }

        function renderHistory() {
            const totalDays = Object.keys(dailyLogs).length;
            const completedDays = Object.values(dailyLogs).filter(log => log.completed).length;
            const complianceRate = totalDays > 0 ? Math.round((completedDays / totalDays) * 100) : 0;

            document.getElementById('totalDays').textContent = totalDays;
            document.getElementById('bestStreak').textContent = calculateBestStreak();
            document.getElementById('complianceRate').textContent = `${complianceRate}%`;

            // Simple weight chart
            const weightChart = document.getElementById('weightChart');
            const sortedMetricDates = Object.keys(metrics).sort();
            
            if (sortedMetricDates.length > 0) {
                let chartHTML = '<div style="display: flex; flex-direction: column; gap: 10px;">';
                for (const date of sortedMetricDates) {
                    const weight = metrics[date].weight;
                    chartHTML += `
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span style="width: 100px; font-size: 0.9em;">${new Date(date).toLocaleDateString()}</span>
                            <div style="flex: 1; background: #e5e7eb; height: 30px; border-radius: 4px; position: relative;">
                                <div style="background: linear-gradient(90deg, #667eea 0%, #764ba2 100%); height: 100%; width: ${(weight / 300) * 100}%; border-radius: 4px;"></div>
                            </div>
                            <span style="width: 60px; font-weight: bold;">${weight} kg</span>
                        </div>
                    `;
                }
                chartHTML += '</div>';
                weightChart.innerHTML = chartHTML;
            } else {
                weightChart.innerHTML = '<p style="text-align: center; color: #6b7280;">No weight data recorded yet.</p>';
            }
        }

        function calculateBestStreak() {
            const profile = profiles[currentProfile];
            if (!profile) return 0;

            const sortedDates = Object.keys(dailyLogs).sort();
            let bestStreak = 0;
            let currentStreak = 0;
            let prevDate = null;

            for (const date of sortedDates) {
                const dayLog = dailyLogs[date];
                let complete = true;
                
                for (const [key, target] of Object.entries(profile.containers)) {
                    if ((dayLog[key] || 0) < target) {
                        complete = false;
                        break;
                    }
                }

                if (complete) {
                    if (!prevDate) {
                        currentStreak = 1;
                    } else {
                        const prevDateTime = new Date(prevDate).getTime();
                        const currentDateTime = new Date(date).getTime();
                        const dayDiff = (currentDateTime - prevDateTime) / (1000 * 60 * 60 * 24);
                        
                        if (dayDiff === 1) {
                            currentStreak++;
                        } else {
                            currentStreak = 1;
                        }
                    }
                    
                    bestStreak = Math.max(bestStreak, currentStreak);
                    prevDate = date;
                } else {
                    currentStreak = 0;
                }
            }

            return bestStreak;
        }

        function updateUI() {
            const profile = profiles[currentProfile];
            
            // Update profile button label
            if (profile && profile.name) {
                const profileNum = currentProfile === 'user1' ? 1 : 2;
                document.getElementById(`profile${profileNum}Btn`).textContent = profile.name;
            }

            // Refresh current tab
            const activeTab = document.querySelector('.tab.active');
            if (activeTab) {
                const tabName = activeTab.textContent.includes('Daily') ? 'daily' :
                               activeTab.textContent.includes('Profile') ? 'profile' :
                               activeTab.textContent.includes('Metrics') ? 'metrics' : 'history';
                
                if (tabName === 'daily') renderDailyTracker();
                else if (tabName === 'profile') loadProfileForm();
                else if (tabName === 'metrics') renderMetricsTimeline();
                else if (tabName === 'history') renderHistory();
            }
        }

        // Initialize on page load
        window.addEventListener('load', init);
    </script>
</body>
</html>
