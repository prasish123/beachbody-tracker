<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Beachbody Portion Control Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        .header-title h1 {
            font-size: 2.5em;
            margin-bottom: 5px;
        }
        .header-title p {
            opacity: 0.9;
        }
        .profile-selector {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }
        .profile-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid white;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .profile-btn:hover, .profile-btn.active {
            background: white;
            color: #667eea;
        }
        .backup-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .content {
            padding: 30px;
        }
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid #e5e7eb;
            flex-wrap: wrap;
        }
        .tab {
            padding: 15px 25px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 1.1em;
            color: #6b7280;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }
        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
            font-weight: 600;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .section-title {
            font-size: 1.8em;
            color: #667eea;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
        }
        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }
        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }
        .btn-secondary {
            background: #6b7280;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
        }
        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 10px;
        }
        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
        }
        .containers-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        .container-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border: 3px solid;
        }
        .container-card.green { border-color: #10b981; background: #d1fae5; }
        .container-card.purple { border-color: #8b5cf6; background: #ede9fe; }
        .container-card.red { border-color: #ef4444; background: #fee2e2; }
        .container-card.yellow { border-color: #f59e0b; background: #fef3c7; }
        .container-card.blue { border-color: #3b82f6; background: #dbeafe; }
        .container-card.orange { border-color: #f97316; background: #ffedd5; }
        .container-card.tsp { border-color: #ec4899; background: #fce7f3; }
        .container-name {
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 1.1em;
        }
        .container-type {
            font-size: 0.85em;
            color: #666;
            margin-bottom: 10px;
        }
        .container-count {
            font-size: 2em;
            font-weight: bold;
            color: #333;
        }
        .tracker-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .tracker-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-left: 5px solid;
        }
        .tracker-card.green { border-left-color: #10b981; }
        .tracker-card.purple { border-left-color: #8b5cf6; }
        .tracker-card.red { border-left-color: #ef4444; }
        .tracker-card.yellow { border-left-color: #f59e0b; }
        .tracker-card.blue { border-left-color: #3b82f6; }
        .tracker-card.orange { border-left-color: #f97316; }
        .tracker-card.tsp { border-left-color: #ec4899; }
        .tracker-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .tracker-title {
            font-weight: bold;
            font-size: 1.1em;
        }
        .tracker-target {
            background: #f3f4f6;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.9em;
        }
        .counter-controls {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        .counter-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            background: #667eea;
            color: white;
            font-size: 1.5em;
            cursor: pointer;
            transition: all 0.2s;
        }
        .counter-btn:hover {
            background: #764ba2;
            transform: scale(1.1);
        }
        .counter-value {
            font-size: 2em;
            font-weight: bold;
            min-width: 50px;
            text-align: center;
        }
        .progress-bar {
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            margin-top: 10px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981 0%, #059669 100%);
            transition: width 0.3s;
        }
        .alert {
            background: #fef3c7;
            border-left: 4px solid #f59e0b;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
        }
        .alert-title {
            font-weight: bold;
            margin-bottom: 5px;
            color: #92400e;
        }
        .metrics-timeline {
            margin-top: 30px;
        }
        .timeline-item {
            background: #f9fafb;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
        }
        .timeline-date {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }
        .timeline-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }
        .metric-item {
            display: flex;
            flex-direction: column;
        }
        .metric-label {
            font-size: 0.85em;
            color: #6b7280;
        }
        .metric-value {
            font-size: 1.3em;
            font-weight: bold;
            color: #111827;
        }
        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-top: 20px;
        }
        .hidden {
            display: none;
        }
        .info-box {
            background: #eff6ff;
            border-left: 4px solid #3b82f6;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .macros-display {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 20px;
        }
        .macro-card {
            background: #f9fafb;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
        }
        .macro-label {
            font-size: 0.9em;
            color: #6b7280;
            margin-bottom: 5px;
        }
        .macro-value {
            font-size: 2em;
            font-weight: bold;
            color: #111827;
        }
        .macro-percentage {
            font-size: 0.85em;
            color: #667eea;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-title">
                <h1>ü•ó Beachbody Portion Control</h1>
                <p>Track your daily nutrition and body metrics</p>
            </div>
            <div class="profile-selector">
                <button class="profile-btn active" onclick="switchProfile('user1')" id="profile1Btn">Profile 1</button>
                <button class="profile-btn" onclick="switchProfile('user2')" id="profile2Btn">Profile 2</button>
                <div class="backup-buttons">
                    <button class="profile-btn" onclick="exportAllData()">üì• Export Backup</button>
                    <label class="profile-btn" style="cursor: pointer;">
                        üì§ Import Backup
                        <input type="file" accept=".json" onchange="importAllData(event)" style="display: none;">
                    </label>
                </div>
            </div>
        </div>
        <div class="content">
            <div class="tabs">
                <button class="tab active" onclick="switchTab('daily')">üìÖ Daily Tracker</button>
                <button class="tab" onclick="switchTab('profile')">üë§ Profile Setup</button>
                <button class="tab" onclick="switchTab('metrics')">üìä Body Metrics</button>
                <button class="tab" onclick="switchTab('foodguide')">ü•ò Food Guide</button>
                <button class="tab" onclick="switchTab('history')">üìà Progress History</button>
            </div>

            <!-- Profile Setup Tab -->
            <div class="tab-content" id="profileTab">
                <h2 class="section-title">Profile Setup</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Name</label>
                        <input type="text" id="profileName" placeholder="Enter name">
                    </div>
                    <div class="form-group">
                        <label>Gender</label>
                        <select id="profileGender">
                            <option value="male">Male</option>
                            <option value="female">Female</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Age (years)</label>
                        <input type="number" id="profileAge" placeholder="Age" min="18" max="100">
                    </div>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Height (cm)</label>
                        <input type="number" id="profileHeight" placeholder="Height in cm" min="120" max="250" step="0.5">
                    </div>
                    <div class="form-group">
                        <label>Current Weight (kg)</label>
                        <input type="number" id="profileWeight" placeholder="Current weight" min="40" max="250" step="0.1">
                    </div>
                    <div class="form-group">
                        <label>Goal Weight (kg)</label>
                        <input type="number" id="profileGoalWeight" placeholder="Goal weight" min="40" max="250" step="0.1">
                    </div>
                </div>
                <div class="form-group">
                    <label>Calculation Method</label>
                    <select id="calculationMethod">
                        <option value="mifflin">Mifflin-St Jeor (Most Accurate)</option>
                        <option value="beachbody">Beachbody Simple Formula</option>
                    </select>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Body Fat % (optional)</label>
                        <input type="number" id="profileBodyFat" placeholder="Body fat percentage" min="5" max="60" step="0.1">
                    </div>
                    <div class="form-group">
                        <label>Activity Level</label>
                        <select id="profileActivity">
                            <option value="1.2">Sedentary (little/no exercise)</option>
                            <option value="1.375">Light (1-3 days/week)</option>
                            <option value="1.55">Moderate (3-5 days/week)</option>
                            <option value="1.725">Active (6-7 days/week)</option>
                            <option value="1.9">Very Active (intense daily)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Goal</label>
                        <select id="profileGoal">
                            <option value="deficit">Weight Loss (500 cal deficit)</option>
                            <option value="maintain">Maintain Weight</option>
                            <option value="surplus">Muscle Gain (250 cal surplus)</option>
                        </select>
                    </div>
                </div>
                <button class="btn" onclick="saveProfile()">üíæ Save Profile & Calculate Plan</button>
                <div id="calculatedPlan" class="hidden">
                    <div class="info-box">
                        <h3 style="margin-bottom: 10px;">Your Nutrition Plan</h3>
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-label">Daily Calories</div>
                                <div class="stat-value" id="displayCalories">0</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">BMR</div>
                                <div class="stat-value" id="displayBMR">0</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">TDEE</div>
                                <div class="stat-value" id="displayTDEE">0</div>
                            </div>
                        </div>
                        <h4 style="margin: 20px 0 10px 0;">Macronutrient Breakdown</h4>
                        <div class="macros-display" id="macrosDisplay"></div>
                        <h4 style="margin: 20px 0 10px 0;">Your Container Allocation</h4>
                        <div class="containers-grid" id="planContainers"></div>
                    </div>
                </div>
            </div>

            <!-- Daily Tracker Tab -->
            <div class="tab-content active" id="dailyTab">
                <h2 class="section-title">Daily Container Tracker</h2>
                <div class="stats-grid" style="margin-bottom: 20px;">
                    <div class="stat-card" id="recoveryCard">
                        <div class="stat-label">‚åö Whoop Recovery</div>
                        <div class="stat-value" id="whoopRecovery">--</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">üí™ Strain</div>
                        <div class="stat-value" id="whoopStrain">--</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">üò¥ Sleep Score</div>
                        <div class="stat-value" id="whoopSleep">--</div>
                    </div>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Current Streak</div>
                        <div class="stat-value" id="streakDisplay">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Today's Progress</div>
                        <div class="stat-value" id="progressDisplay">0%</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Target Calories</div>
                        <div class="stat-value" id="calorieDisplay">-</div>
                    </div>
                </div>
                <div id="trackerContent">
                    <p style="text-align: center; padding: 40px; color: #6b7280;">
                        Please set up your profile first to start tracking.
                    </p>
                </div>
                <div id="missedAlert" class="alert hidden">
                    <div class="alert-title">‚ö†Ô∏è Containers Remaining Today</div>
                    <ul id="missedList" style="margin-top: 10px; padding-left: 20px;"></ul>
                </div>
                <button class="btn hidden" id="completeDayBtn" onclick="completeDay()" style="margin-top: 20px;">
                    ‚úÖ Complete Day
                </button>
            </div>

            <!-- Body Metrics Tab -->
            <div class="tab-content" id="metricsTab">
                <h2 class="section-title">Body Metrics Tracking</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Date</label>
                        <input type="date" id="metricDate">
                    </div>
                    <div class="form-group">
                        <label>Weight (kg)</label>
                        <input type="number" id="metricWeight" placeholder="Weight" step="0.1">
                    </div>
                    <div class="form-group">
                        <label>Body Fat % (optional)</label>
                        <input type="number" id="metricBodyFat" placeholder="Body fat %" step="0.1">
                    </div>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Waist (inches)</label>
                        <input type="number" id="metricWaist" placeholder="Waist measurement" step="0.1">
                    </div>
                    <div class="form-group">
                        <label>Hips (inches)</label>
                        <input type="number" id="metricHips" placeholder="Hip measurement" step="0.1">
                    </div>
                    <div class="form-group">
                        <label>Chest (inches)</label>
                        <input type="number" id="metricChest" placeholder="Chest measurement" step="0.1">
                    </div>
                </div>
                <h3 style="margin: 30px 0 15px 0; color: #667eea;">Workout Tracking</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Beachbody Workout</label>
                        <select id="workoutType">
                            <option value="">None</option>
                            <option value="Body Beast">Body Beast</option>
                            <option value="P90X">P90X</option>
                            <option value="P90X3">P90X3</option>
                            <option value="Insanity">Insanity</option>
                            <option value="21 Day Fix">21 Day Fix</option>
                            <option value="LIIFT4">LIIFT4</option>
                            <option value="Morning Meltdown 100">Morning Meltdown 100</option>
                            <option value="10 Rounds">10 Rounds</option>
                            <option value="6 Weeks of The Work">6 Weeks of The Work</option>
                            <option value="MBF">MBF (Muscle Burns Fat)</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Workout Duration (minutes)</label>
                        <input type="number" id="workoutDuration" placeholder="Minutes" min="0">
                    </div>
                    <div class="form-group">
                        <label>Steps/Walking (steps)</label>
                        <input type="number" id="dailySteps" placeholder="e.g., 10000" min="0">
                    </div>
                </div>
                <div class="form-group">
                    <label>Progress Photo (optional)</label>
                    <input type="file" id="metricPhoto" accept="image/*" capture="environment">
                    <small style="color: #6b7280; margin-top: 5px; display: block;">Take a weekly progress photo</small>
                </div>
                <div class="form-group">
                    <label>Notes</label>
                    <input type="text" id="metricNotes" placeholder="How are you feeling? Any observations?">
                </div>

                <!-- Renpho CSV Import -->
                <div class="form-group">
                    <label>Import Renpho CSV (Weight + Body Fat)</label>
                    <input type="file" accept=".csv" onchange="importRenphoCSV(event)">
                    <small>Export CSV from Renpho app ‚Üí import here to auto-fill weight & body fat</small>
                </div>

                <button class="btn" onclick="saveMetrics()">üíæ Save Metrics</button>
                <div class="metrics-timeline" id="metricsTimeline"></div>
            </div>

            <!-- History Tab -->
            <div class="tab-content" id="historyTab">
                <h2 class="section-title">Progress History</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Total Days Tracked</div>
                        <div class="stat-value" id="totalDays">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Best Streak</div>
                        <div class="stat-value" id="bestStreak">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Compliance Rate</div>
                        <div class="stat-value" id="complianceRate">0%</div>
                    </div>
                </div>
                <div class="chart-container">
                    <h3 style="margin-bottom: 15px;">Weight Progress</h3>
                    <div id="weightChart"></div>
                </div>
                <div class="chart-container">
                    <h3 style="margin-bottom: 15px;">Container Completion by Week</h3>
                    <div id="containerChart"></div>
                </div>
            </div>

            <!-- Food Guide Tab -->
            <div class="tab-content" id="foodguideTab">
                <h2 class="section-title">ü•ò Indian Food Guide</h2>
                <div class="info-box">
                    <p style="margin-bottom: 10px;">Quick reference for common Indian foods and their container equivalents. Use this guide when logging your daily containers.</p>
                </div>
                <!-- (Indian Food Guide content unchanged - kept exactly as original for brevity) -->
                <div style="margin-top: 30px;">
                    <!-- All the colored container cards with Indian food examples remain the same -->
                    <!-- Omitted here for length, but copy-paste from your original HTML -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Container definitions
        const containers = {
            green: { name: 'Green', type: 'Vegetables', color: 'green' },
            purple: { name: 'Purple', type: 'Fruits', color: 'purple' },
            red: { name: 'Red', type: 'Proteins', color: 'red' },
            yellow: { name: 'Yellow', type: 'Carbs', color: 'yellow' },
            blue: { name: 'Blue', type: 'Healthy Fats', color: 'blue' },
            orange: { name: 'Orange', type: 'Seeds/Dressings', color: 'orange' },
            tsp: { name: 'tsp', type: 'Oils & Nut Butters', color: 'tsp' }
        };

        const containerPlans = {
            1200: { green: 3, purple: 2, red: 4, yellow: 2, blue: 1, orange: 1, tsp: 2 },
            1500: { green: 4, purple: 3, red: 4, yellow: 3, blue: 1, orange: 1, tsp: 2 },
            1800: { green: 5, purple: 3, red: 5, yellow: 4, blue: 1, orange: 1, tsp: 3 },
            2100: { green: 6, purple: 4, red: 6, yellow: 4, blue: 1, orange: 1, tsp: 4 },
            2400: { green: 8, purple: 4, red: 6, yellow: 5, blue: 2, orange: 1, tsp: 4 }
        };

        let currentProfile = 'user1';
        let profiles = {};
        let dailyLogs = {};
        let metrics = {};

        // Fixed storage using localStorage
        function loadData() {
            profiles = JSON.parse(localStorage.getItem('bb_profiles') || '{}');
            const logsKey = `bb_logs_${currentProfile}`;
            const metricsKey = `bb_metrics_${currentProfile}`;
            dailyLogs = JSON.parse(localStorage.getItem(logsKey) || '{}');
            metrics = JSON.parse(localStorage.getItem(metricsKey) || '{}');
        }

        function saveData() {
            localStorage.setItem('bb_profiles', JSON.stringify(profiles));
            localStorage.setItem(`bb_logs_${currentProfile}`, JSON.stringify(dailyLogs));
            localStorage.setItem(`bb_metrics_${currentProfile}`, JSON.stringify(metrics));
        }

        // Backup functions
        function exportAllData() {
            const allData = {
                profiles: JSON.parse(localStorage.getItem('bb_profiles') || '{}'),
                logs_user1: JSON.parse(localStorage.getItem('bb_logs_user1') || '{}'),
                logs_user2: JSON.parse(localStorage.getItem('bb_logs_user2') || '{}'),
                metrics_user1: JSON.parse(localStorage.getItem('bb_metrics_user1') || '{}'),
                metrics_user2: JSON.parse(localStorage.getItem('bb_metrics_user2') || '{}')
            };
            const blob = new Blob([JSON.stringify(allData, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `beachbody_backup_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
        }

        function importAllData(event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const allData = JSON.parse(e.target.result);
                    localStorage.setItem('bb_profiles', JSON.stringify(allData.profiles || {}));
                    localStorage.setItem('bb_logs_user1', JSON.stringify(allData.logs_user1 || {}));
                    localStorage.setItem('bb_logs_user2', JSON.stringify(allData.logs_user2 || {}));
                    localStorage.setItem('bb_metrics_user1', JSON.stringify(allData.metrics_user1 || {}));
                    localStorage.setItem('bb_metrics_user2', JSON.stringify(allData.metrics_user2 || {}));
                    alert('Data imported successfully! Refresh the page.');
                    location.reload();
                } catch (err) {
                    alert('Invalid backup file');
                }
            };
            reader.readAsText(file);
        }

        // Renpho CSV Import
        function importRenphoCSV(event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                const text = e.target.result;
                const lines = text.split(/\r?\n/);
                let imported = 0;
                for (let i = 1; i < lines.length; i++) {  // skip header
                    const cols = lines[i].split(',');
                    if (cols.length < 3) continue;
                    const date = cols[0].trim().split(' ')[0]; // handle possible timestamp
                    const weight = parseFloat(cols[1]);
                    const bodyFat = parseFloat(cols[6] || cols[2]); // adjust index if needed
                    if (!date || isNaN(weight)) continue;
                    if (!metrics[date]) metrics[date] = {};
                    metrics[date].weight = weight;
                    if (!isNaN(bodyFat)) metrics[date].bodyFat = bodyFat;
                    imported++;
                }
                saveData();
                alert(`Imported ${imported} measurements from Renpho!`);
                renderMetricsTimeline();
            };
            reader.readAsText(file);
        }

        // Rest of your original script (unchanged except minor fixes)
        // ... [All the original functions: calculateBMR, saveProfile, renderDailyTracker, etc.]
        // (Kept identical to your original code for functionality)

        // Initialize
        function init() {
            const today = new Date();
            document.getElementById('metricDate').valueAsDate = today;
            loadData();
            updateUI();
        }

        // ... [rest of original script functions]

        window.addEventListener('load', init);

        // Whoop integration (unchanged)
        const WHOOP_API = 'https://whoop-backend-production.up.railway.app';
        // ... [Whoop code unchanged]
    </script>
</body>
</html>
